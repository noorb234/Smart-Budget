<?php
include 'db_connection.php'; // Include database connection file

// Fetch budget data from the database
typically assuming table 'budget' with 'category', 'amount', and 'date'
$query = "SELECT category, SUM(amount) as total FROM budget GROUP BY category";
$result = mysqli_query($conn, $query);

$categories = [];
$amounts = [];
$colors = [];

// Define category colors
$categoryColors = [
    'Food' => '#FF5733',
    'Transport' => '#33FF57',
    'Entertainment' => '#3357FF',
    'Utilities' => '#F39C12',
    'Health' => '#8E44AD',
    'Other' => '#BDC3C7'
];

while ($row = mysqli_fetch_assoc($result)) {
    $categories[] = $row['category'];
    $amounts[] = $row['total'];
    $colors[] = $categoryColors[$row['category']] ?? '#000000'; // Default color if category not found
}

mysqli_close($conn);
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Reports</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h2>Budget Report</h2>
    <canvas id="pieChart"></canvas>
    <canvas id="barChart"></canvas>
    
    <script>
        const categories = <?php echo json_encode($categories); ?>;
        const amounts = <?php echo json_encode($amounts); ?>;
        const colors = <?php echo json_encode($colors); ?>;
        
        // Pie Chart
        new Chart(document.getElementById('pieChart'), {
            type: 'pie',
            data: {
                labels: categories,
                datasets: [{
                    data: amounts,
                    backgroundColor: colors
                }]
            }
        });
        
        // Bar Chart
        new Chart(document.getElementById('barChart'), {
            type: 'bar',
            data: {
                labels: categories,
                datasets: [{
                    label: 'Expenses',
                    data: amounts,
                    backgroundColor: colors
                }]
            }
        });
    </script>
</body>
</html>
